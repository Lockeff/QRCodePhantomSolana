<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect to Phantom Wallet via QR Code</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <h1>Connect to Phantom Wallet via QR Code</h1>

    <!-- Bouton pour générer le QR code -->
    <button id="connectButton">Generate QR Code</button>

    <!-- QR code container -->
    <div id="qrcode" style="margin-top: 20px;"></div>

    <!-- Message pour afficher la clé publique après connexion -->
    <h2 id="publicKeyMessage" style="display: none;">Your Solana Wallet Public Key: </h2>
    <p id="publicKey"></p>

    <script>
        // Fonction pour détecter Phantom Wallet dans le navigateur
        function getProvider() {
            if ("solana" in window) {
                const provider = window.solana;
                if (provider.isPhantom) {
                    return provider;
                }
            }
            window.open("https://phantom.app/", "_blank");
        }

        // Fonction pour générer un lien de connexion Phantom et un QR code
        function generateQRCode() {
            const provider = getProvider();
            
            if (!provider) {
                alert("Phantom Wallet non détecté.");
                return;
            }
            
            // Appel à Phantom Wallet pour se connecter
            provider.connect()
                .then((resp) => {
                    const publicKey = resp.publicKey.toString();  // Récupération de la clé publique
                    document.getElementById('publicKeyMessage').style.display = 'block';
                    document.getElementById('publicKey').innerText = publicKey;  // Affichage de la clé publique
                })
                .catch((err) => {
                    console.error("Échec de la connexion:", err);
                });

            // Générer un QR code avec une URL de connexion si nécessaire pour mobile
            const appUrl = window.location.href;  
            const phantomDeepLink = `https://phantom.app/ul/v1/connect?app_url=${encodeURIComponent(appUrl)}&cluster=devnet`;

            // Générer le QR code
            new QRCode(document.getElementById("qrcode"), {
                text: phantomDeepLink,
                width: 200,
                height: 200
            });
        }

        // Écouter le clic du bouton pour générer un QR code
        document.getElementById("connectButton").addEventListener("click", () => {
            generateQRCode();  // Générer le QR code avec les bons paramètres
        });

    </script>
</body>
</html>
