<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect to Phantom Wallet via QR Code</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <h1>Connect to Phantom Wallet via QR Code</h1>

    <!-- Bouton pour générer le QR code -->
    <button id="connectButton">Generate QR Code</button>

    <!-- QR code container -->
    <div id="qrcode" style="margin-top: 20px;"></div>

    <!-- Message pour afficher la clé publique après connexion -->
    <h2 id="publicKeyMessage" style="display: none;">Your Solana Wallet Public Key: </h2>
    <p id="publicKey"></p>

    <script>
        // Vérification si Phantom Wallet est disponible
        function getProvider() {
            if ("solana" in window) {
                const provider = window.solana;
                if (provider.isPhantom) {
                    return provider;
                }
            }
            window.open("https://phantom.app/", "_blank");  // Redirection pour installer Phantom si non présent
        }

        // Fonction pour connecter le wallet Phantom
        async function connectToPhantom() {
            const provider = getProvider();

            if (provider) {
                try {
                    const resp = await provider.connect();  // Connexion à Phantom Wallet
                    const publicKey = resp.publicKey.toString();  // Récupération de la clé publique

                    // Afficher la clé publique
                    document.getElementById('publicKeyMessage').style.display = 'block';
                    document.getElementById('publicKey').innerText = publicKey;
                    console.log("Public Key:", publicKey);
                } catch (err) {
                    console.error("Erreur de connexion:", err);
                }
            } else {
                alert("Phantom Wallet non installé !");
            }
        }

        // Fonction pour générer un QR code (utile pour mobile ou autre)
        function generateQRCode() {
            const appUrl = window.location.href;
            const redirectLink = appUrl;  // Lien pour redirection après la connexion Phantom
            const phantomDeepLink = `https://phantom.app/ul/v1/connect?app_url=${encodeURIComponent(appUrl)}&redirect_link=${encodeURIComponent(redirectLink)}&cluster=devnet`;

            // Générer un QR code
            new QRCode(document.getElementById("qrcode"), {
                text: phantomDeepLink,
                width: 200,
                height: 200
            });
        }

        // Clic sur le bouton pour connecter à Phantom et générer le QR code
        document.getElementById("connectButton").addEventListener("click", () => {
            connectToPhantom();  // Connexion via Phantom Wallet
            generateQRCode();  // Générer le QR code pour les mobiles
        });
    </script>
</body>
</html>
